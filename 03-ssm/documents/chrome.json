{
  "schemaVersion": "2.2",
  "description": "Custom SSM Document to install Chrome",
  "mainSteps": [
    {
      "action": "aws:runPowerShellScript",
      "name": "WBUILDER_InstallChrome",
      "inputs": {
        "runCommand": [
          "$ErrorActionPreference = 'Stop'",
          "",
          "$LocalTempDir   = $env:TEMP",
          "$ChromeInstaller = \"chrome_installer.msi\"",
          "$DownloadUrl = 'https://dl.google.com/dl/chrome/install/googlechromestandaloneenterprise64.msi'",
          "",
          "# Disable progress bar for faster/silent download",
          "$ProgressPreference = 'SilentlyContinue'",
          "",
          "Write-Output \"Downloading Chrome MSI...\"",
          "try {",
          "  Invoke-WebRequest -Uri $DownloadUrl -OutFile \"$LocalTempDir\\$ChromeInstaller\" -UseBasicParsing",
          "} catch {",
          "  Write-Output \"ERROR: Failed to download Chrome MSI: $($_.Exception.Message)\"",
          "  exit 1",
          "}",
          "",
          "Write-Output \"Installing Chrome silently...\"",
          "Start-Process msiexec.exe -ArgumentList \"/i `\"$LocalTempDir\\$ChromeInstaller`\" /qn /norestart\" -Wait",
          "if ($LASTEXITCODE -ne 0) {",
          "  Write-Output \"ERROR: Chrome installer failed with exit code $LASTEXITCODE\"",
          "  exit $LASTEXITCODE",
          "}",
          "",
          "Write-Output \"Cleaning up installer...\"",
          "Remove-Item \"$LocalTempDir\\$ChromeInstaller\" -Force -ErrorAction SilentlyContinue",
          "",
          "Write-Output \"Chrome installation complete.\"",
          "exit 0"
        ]
      }
    }
  ]
}
